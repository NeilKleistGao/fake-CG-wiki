## 相机与透镜
### 小孔成像
在古代，诸如墨子、亚里士多德等学者已经发现了小孔成像的现象。小孔成像利用了光沿直线传播的特性（图片来自于GAMES101）：

![Screenshot from 2021-12-11 08-34-32.png](https://s2.loli.net/2021/12/11/dWmnj2g8ueOR31Q.png)

由于光线仅能沿着直线传播，物体反射的光线只有在特定的角度下（见上图）才能穿过小孔，从而反射到另外一端。此时我们在小孔的另一端放置上感光元件，
就可以将图像呈现出来。为了防止感光元件接受到外界其他的光线，我们需要将感光元件放置在一个暗箱中。

人无法通过小孔看到对面的全部景象，但我们依然可以使用小孔成像，这是因为人眼所感知到的物理量为光亮度，而感光材料上所接受的为光照度（并会随着时间增加而累加）。

虽然小孔成像的原理非常简单，并且要求长时间的曝光，但目前在艺术等方面仍然有着广泛的应用。

### 视场
视场，即Field of View（FoV），表示摄像机所能看到的范围。视场有两种不同的表示方式，即从侧面看和从上面看能得到不同的视场表示。两种表示都没有错误，
且被广泛使用。因此，这里以侧面观察的视场为例：

![Screenshot from 2021-12-11 08-53-11.png](https://s2.loli.net/2021/12/11/DnlUMvRWFH4NC9i.png)

最底部是我们的感光元件，他的高度为 $h$ ；中间的焦点为我们的小孔。感光元件顶部和底部发出的射线穿过小孔，达到小孔的另一测，这个范围就是我们所能成像的范围。
其中，小孔到感光元件的距离我们称之为焦距 $f$ 。为了表示视场的大小，我们需要计算两条射线之间的夹角，即 $FoV = arctan(\frac{h}{2f})$ 。
根据这个角度，以及感光元件的高度和宽高比，我们就能推算出这个相机的其他属性。

由于历史原因，我们平常所见到的焦距的数字是使用 $36 \times 24 mm$ 大小的胶片（35毫米格式的胶片）与视场角的大小来计算的，并不一定是实际的大小，这个焦距被称为等效焦距。

### 曝光
感光元件接受光照，并不关心光照的“效率”，即感光元件不考虑光通量，而是会记录下一定时间内所有的光照度。因此，曝光度定义为 $T \times E$ ，其中 $T$ 为曝光时间，
而 $E$ 则是光照度。在摄像过程中，我们需要对曝光度进行调整：曝光过低则图像很暗；反之曝光过高图像又会接近全白。调整曝光度通常可以从两个角度进行考虑：调整光圈大小和调整曝光时间。

光圈大小控制着感光元件可以接受到的光照度的大小，即光圈控制着相机的进光量。光圈一般是一个面积可变的孔状光栅（图片来自于维基百科）：

![Screenshot from 2021-12-11 09-19-42.png](https://s2.loli.net/2021/12/11/OZdDjszQhWrStBe.png)

光圈的大小由焦比（也叫f数）来表示。 焦比等于焦距除以孔径，是一个无量纲的变量。在焦距一定的情况下，焦比越大，则孔径越小，进光量也越小。
随着光圈变大，感光元件上某个点能接受到的光照度就越高。这里照度的增加是由于一个点可以接受更多物体所反射过来的光线，相当于做了一半的滤波操作，所以拍出的照片的背景会变得模糊（即景深效果）。

此外，我们还可以通过调整曝光时间来控制曝光度。曝光时间通过快门来进行控制。当快门打开时，光线即可进入到相机内部。我们直接使用一个数字来描述快门时间，
如1/1000表示快门开放的时间为0.001秒。如果拍摄的物体本身是运动的，增加快门时间会导致拍摄到的图像变得模糊（即动态模糊效果），这样的模糊同样是由于连续的采样造成的（与光圈大小不同，这里的连续是时间上的连续）。

除了两个常用方法外，相机一般还支持通过ISO来调整图片亮度。ISO本身并不控制曝光度，而是在成像完成后直接对图像进行处理。由于处理方式是直接对像素值进行缩放，所以一般会有较大的噪声。

光圈大小和快门时间是相互制约的关系：光圈大快门时间长会导致过曝；光圈小快门时间短会导致曝光不足。因此，景深与动态模糊不可兼得。

### 透镜
小孔成像固然很好，但是也有其不足：如果曝光时间过短，我们可能什么都看不到。为此我们需要短时间内快速聚集大量的光线，从而在较短的时间内完成曝光。此时我们会用到透镜。
为了方便，我们假定研究的透镜为理想的薄透镜，即透镜的厚度忽略不计（图片来自于GAMES101，下同）：

![Screenshot from 2021-12-11 09-50-37.png](https://s2.loli.net/2021/12/11/YRvLPQAVeXU4O8B.png)

垂直于透镜的平行光，在进入透镜之后将会被聚集在一点，这个点被称为焦点，焦点到透镜的距离被称为焦距。根据光路的可逆性，如果一束光穿过了焦点并通过透镜，
这束光将会被分解为一系列的平行光。如果光线穿过了透镜的中心，则其方向不会发生改变。

此外，薄透镜还满足一个物理规律：

![Screenshot from 2021-12-11 09-57-39.png](https://s2.loli.net/2021/12/11/wrlbFu2zRQjqgno.png)

我们在透镜的左侧放上一个物体，物体到透镜的距离记作 $z_o$ ，该物体会在透镜的右侧成像，像到透镜的距离及做 $z_i$ ，透镜的焦距记作 $f$ 。

![Screenshot from 2021-12-11 10-03-11.png](https://s2.loli.net/2021/12/11/qrfNt67KSGgpaHW.png)

在图中，我们可以找到两对相似三角形，分别位于透镜的左侧和右侧。根据相似关系，我们可以得到：

$$
\begin{array}{c}
\frac{h_0}{h_i} = \frac{z_o - f}{f} \\
\frac{h_0}{h_i} = \frac{f}{z_i - f}
\end{array}
$$

连立两个等式，整理后我们可以得到 $\frac{1}{f} = \frac{1}{z_o} + \frac{1}{z_i}$ 。这就是**高斯成像公式**。

根据高斯成像公式，我们可以解释弥散圈（Circle of Confusion）现象：

![Screenshot from 2021-12-11 10-16-31.png](https://s2.loli.net/2021/12/11/oMgC4OR2a1SJsmG.png)

根据焦距和感光元件的位置，我们可以求出一个“理想成像距离”：将物体放在该位置，我们可以正好将像投到感光元件上。但实际上，很多时候物距和理想距离并不相等。
如图所示，由于物距过远，光线经过透镜在感光元件前形成了像。成像的光线并不会停留在原地，而是会继续传播，此时打到感光平面上光线就不再是一个点，而是一个圆。

## 光场相机
### 光场
我们的成像过程大致可以分为以下的步骤：
+ 在某一时刻，某一位置停下
+ 选取一个角度
+ 对这个角度的光线进行采样

完成这些步骤后，我们就将这些信息压缩为了一幅二维的图像。这样做必然会导致信息的丢失。为了保证所有的信息都得到保留，
我们将这些信息写为一个新的函数： $L(x, y, z, \theta , \phi , \lambda , t)$ 。其中， $x, y, z$ 表示我们在空间中的位置； $\theta , \phi$ 表示我们观察的角度；
为了表示光线，我们使用 $\lambda$ 表示其波长， $t$ 表示当前的时间。这就是**七维全光函数**，它所表示的就是一个光场。

七维的函数对于我们来说开销太大了，因此我们需要考虑对其进行压缩：
+ 我们不再记录函数中每一个波长对应的分量，反之，我们令函数的返回值为RGB，从而抛弃掉 $\lambda$
+ 对于一个函数，我们只记录下一个特定时刻的值，而不是所有时刻。如果有需要，我们使用多个函数来进行表示

此时我们的全光函数被削减为了 $L(x, y, z, \theta, \phi)$ 的形式。这是一个五维的函数。然而我们在观察的过程中，并不是所有的方向都能看到（南无三，世上无人背后长眼！），
记录全部的方向也是没有必要的。我们可以限制 $\theta, \phi$ 的定义域来达到效果，但一个更聪明的办法是，通过两个平面来定义我们所看到的光场（图片来自于GAMES101）：

![Screenshot from 2021-12-11 10-48-56.png](https://s2.loli.net/2021/12/11/mAjFGwla6XdskS2.png)

由于光线沿直线传播，我们只需要两个点即可定义一条直线。我们选取平面上的两个点，即可生成一条光线。此时我们的点坐标依然是三维的，
为了简化表示，我们使用类似于纹理映射的方法，将三维的点写为平面上的uv坐标，这样我们就得到了光场的四维表示： $L(u, v, s, t)$ 。

假定uv平面是靠近相机的平面，而st平面是靠近世界的平面。我们在uv平面上固定一个点，并且向st平面看去，我们就能看到整个世界。这就好比我们在uv平面上开了一个小孔，从而进行小孔成像。
反过来，我们假设从uv平面上看向st平面上的同一个点，此时我们就可以逆向将光亮度拆解出来。

### 光场相机
由于光场可以记录额外的方向信息，我们可以使用光场来制作相机，使得相机拍下的照片同样携带这些信息，以便于我们在拍照后对于光圈、焦距等属性的动态调整。

光场相机的原理类似于苍蝇的复眼结构（图片来自于GAMES101，下同）：

![Screenshot from 2021-12-11 11-26-40.png](https://s2.loli.net/2021/12/11/jNVS64atW7F1O8Z.png)

普通的相机只记录对应位置的光照度，而光场相机记录光亮度，即将光照度分解到不同的方向上：

![Screenshot from 2021-12-11 11-36-22.png](https://s2.loli.net/2021/12/11/WTpjaStLKm2sY9G.png)

当我们需要移动摄像机，或者重新调整焦距时，我们计算出对应每一个小区域内，我们应该采样的方向，并将对应方向上的值拼接起来，最终我们就能得到一张照片。

这样的动态效果看起来非常的炫酷，但是由于我们需要存储更多的信息，实际照片的分辨率会大幅下降。


## 参考资料
+ [GAMES101-现代计算机图形学入门-闫令琪](https://www.bilibili.com/video/BV1X7411F744?p=19)
+ [针孔相机-维基百科](https://zh.wikipedia.org/wiki/%E9%87%9D%E5%AD%94%E7%9B%B8%E6%A9%9F)
+ [光圈-维基百科](https://zh.wikipedia.org/wiki/%E5%85%89%E5%9C%88)
+ [焦比-维基百科](https://zh.wikipedia.org/wiki/%E7%84%A6%E6%AF%94)
+ [光场(Light Field)是什么？](https://zhuanlan.zhihu.com/p/150925126)